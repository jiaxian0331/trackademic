<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trackademic Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashstyle.css') }}">
</head>
<body>
<div class="container">
    <header class="header">
        <div class="logo"><img src="trackademiclogo.png" alt="Logo"></div>
        <div class="dashboard-title">Dashboard</div>
        <div class="logout"><a href="{{ url_for('logout') }}">Logout</a></div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <nav class="nav-menu">
                <div class="nav-item user-profile active-nav">
                    <a href="{{ url_for('dashboard') }}">{{ username }}</a>
                </div>
                <div class="nav-item"><a href="{{ url_for('saved_posts') }}">Saved Posts</a></div>
                <div class="nav-item"><span>GPA/CGPA Calculation</span></div>
                <div class="nav-item"><span>Planner</span></div>
            </nav>
        </aside>

        <main class="main-content">
            <div class="post-input-bar">
                <form method="POST" enctype="multipart/form-data">
                    <textarea name="content" placeholder="What's on your mind?" required></textarea>
                    <input type="file" name="file">
                    <button type="submit">Post</button>
                </form>
            </div>

            <div class="posts-feed">
                {% for post_id, content, filename, poster, post_user_id, is_saved, comments in posts %}
                <div class="post">
                    <p><strong>{{ poster }}</strong></p>
                    <p>{{ content }}</p>

                    {% if filename %}
                        {% if filename.endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
                            <img src="{{ url_for('static', filename='uploads/' ~ filename) }}" alt="Post image">
                        {% else %}
                            <p>File: <a href="{{ url_for('static', filename='uploads/' ~ filename) }}">{{ filename }}</a></p>
                        {% endif %}
                    {% endif %}

                    <div class="post-actions">
                        {% if post_user_id == session['user_id'] %}
                        <form action="{{ url_for('delete_post', post_id=post_id) }}" method="POST">
                            <button type="submit">Delete</button>
                        </form>
                        {% endif %}

                        {% if is_saved %}
                            <button disabled>Saved</button>
                        {% else %}
                            <form action="{{ url_for('save_post', post_id=post_id) }}" method="POST">
                                <button type="submit">Save</button>
                            </form>
                        {% endif %}
                    </div>

                    <div class="comments">
                        {% for comment_id, username, comment_text, comment_user_id in comments %}
                        <p>
                            <strong>{{ username }}:</strong> {{ comment_text }}
                            {% if comment_user_id == session['user_id'] %}
                            <form action="{{ url_for('delete_comment', comment_id=comment_id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="delete-comment-btn">Delete</button>
                            </form>
                            {% endif %}
                        </p>
                        {% endfor %}

                        <form action="{{ url_for('add_comment', post_id=post_id) }}" method="POST">
                            <input type="text" name="comment" placeholder="Add a comment..." required>
                            <button type="submit">Send</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>
</div>
</body>
</html>
